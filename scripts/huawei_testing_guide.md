# 华为设备测试指南

## 修复的问题

我们针对华为手机闪退问题进行了以下修复：

### 1. 音频初始化改进
- 添加了音频播放器的安全初始化机制
- 增加了华为设备特殊的延迟配置
- 添加了音频上下文配置的错误处理
- 实现了音频播放器的备用方案

### 2. 数据库初始化优化
- 添加了数据库初始化的重试机制
- 增加了华为设备的特殊等待时间
- 改进了错误处理和日志记录

### 3. 应用启动流程改进
- 重新组织了服务初始化顺序
- 添加了服务初始化的错误容错机制
- 确保即使某些服务失败，应用仍能正常启动

### 4. 权限和配置优化
- 添加了华为设备特殊权限
- 配置了网络安全策略
- 优化了应用清单文件

## 测试步骤

### 1. 安装测试版本

**Debug版本（推荐用于测试）：**
```bash
# 位置：build/app/outputs/flutter-apk/app-debug.apk
# 大小：约80MB
# 特点：包含详细日志，便于问题诊断
```

**Release版本：**
```bash
# 位置：build/app/outputs/flutter-apk/app-release.apk  
# 大小：约54MB
# 特点：优化版本，性能更好
```

### 2. 华为设备特殊设置

在安装前，请在华为手机上进行以下设置：

#### 开发者选项
1. 进入 **设置** > **关于手机**
2. 连续点击 **版本号** 7次启用开发者选项
3. 返回设置，进入 **系统和更新** > **开发人员选项**
4. 启用 **USB调试**
5. 启用 **"仅充电"模式下允许ADB调试**

#### 应用权限设置
1. 安装APK后，进入 **设置** > **应用和服务** > **应用管理**
2. 找到 **Mindra** 应用
3. 点击 **权限**，确保以下权限已开启：
   - 存储权限
   - 音频权限
   - 通知权限

#### 电池优化设置
1. 进入 **设置** > **电池** > **应用启动管理**
2. 找到 **Mindra** 应用
3. 关闭 **自动管理**
4. 手动开启：
   - 允许自启动
   - 允许关联启动
   - 允许后台活动

### 3. 测试检查清单

安装完成后，请按以下顺序测试：

#### 基础功能测试
- [ ] 应用能正常启动（不闪退）
- [ ] 主界面正常显示
- [ ] 导航功能正常
- [ ] 设置页面可以打开

#### 音频功能测试
- [ ] 可以播放冥想音频
- [ ] 音频控制按钮正常工作
- [ ] 背景音效可以正常播放
- [ ] 音频和音效可以同时播放

#### 数据功能测试
- [ ] 可以添加新的媒体项目
- [ ] 数据能正常保存和读取
- [ ] 应用重启后数据仍然存在

#### 通知功能测试
- [ ] 可以设置提醒
- [ ] 通知能正常显示

### 4. 问题诊断

如果仍然出现问题，请按以下步骤收集信息：

#### 使用ADB收集日志
```bash
# 连接华为手机到电脑
# 确保已启用USB调试

# 清除之前的日志
adb logcat -c

# 启动应用并收集日志
adb logcat | grep -E "(flutter|Mindra|AndroidRuntime)"

# 或者保存到文件
adb logcat | grep -E "(flutter|Mindra|AndroidRuntime)" > mindra_log.txt
```

#### 关键错误信息
请特别关注以下类型的错误：
- `FATAL EXCEPTION`
- `AndroidRuntime`
- `Database`
- `AudioPlayer`
- `Permission`

### 5. 常见问题解决

#### 问题1：仍然闪退
**解决方案：**
1. 完全卸载应用
2. 重启手机
3. 重新安装debug版本
4. 检查权限设置

#### 问题2：音频无法播放
**解决方案：**
1. 检查音频权限
2. 确保手机音量不为0
3. 尝试使用耳机测试
4. 检查是否有其他音频应用占用

#### 问题3：数据无法保存
**解决方案：**
1. 检查存储权限
2. 确保手机存储空间充足
3. 尝试清除应用数据后重新测试

## 反馈信息

如果测试中遇到问题，请提供以下信息：

1. **设备信息：**
   - 华为手机型号
   - EMUI/HarmonyOS版本
   - Android版本

2. **问题描述：**
   - 具体的错误现象
   - 复现步骤
   - 错误发生的时机

3. **日志信息：**
   - ADB日志（如果可以获取）
   - 错误截图

## 版本对比

| 版本 | 修复内容 | 推荐用途 |
|------|----------|----------|
| v1.0.0+1 (原版) | 无华为优化 | 其他Android设备 |
| v1.0.0+2 (修复版) | 华为兼容性修复 | 华为设备测试 |

修复版本的主要改进：
- ✅ 音频初始化安全机制
- ✅ 数据库重试机制  
- ✅ 服务启动容错处理
- ✅ 华为特殊权限配置
- ✅ 网络安全策略优化
